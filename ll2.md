# Лекция 8. || программирование (продолжение)

![](img/xkcd.webp)

- слайды с прошлой лекции: https://github.com/ivtipm/ProcessCalculus/blob/master/PC.%20lec.%20parallel.pdf

## Повторение
- Зачем?
- Классификация видов параллелизма
- асинхронный?
- parallelism vs concurency
  - в чём приемущество каждого из них
- Закон Амдала
- с чего начать оптимизацию программы?
  - профилирование
  - об оптимизации (https://habr.com/ru/post/309796/)
- Виды || декомпозиции
- атомарная операция
- потоковая безопасность
  - потокобезопасны ли коллекции вашего любимого языка программирования?  (см. домашнюю работу)


- проблемы || программирования и способы их решения
  - состояние гонки (неопределённость параллелизма)
  - взаимная блокировка
  - проблема ABA


## Профилирование производительности кода
- cProfiler: https://github.com/VetrovSV/Programming/blob/master/Programming_optimisation.pdf
- профилирование в PyCharm Professional: https://www.jetbrains.com/help/pycharm/profiler.html#work-with-profiling-results
- профилирование в Visual Studio: https://docs.microsoft.com/ru-ru/visualstudio/profiling/beginners-guide-to-performance-profiling?view=vs-2019


## Многопоточное программирование
- примеры C++ [examples/example_thread/main.cpp](examples/example_thread/main.cpp)
  - проблема функции bar
- пример QThread: [examples/example_qthread](examples/example_qthread)
  - остановка одного потока из другого потока
- примеры в Java: [examples/example_java_threads](examples/example_java_threads), [examples/example_java_thread-gui](examples/example_java_thread-gui)
- пример pyhton:[examples/thread_python/main.py](examples/thread_python/main.py)



### Примеры: сети Петри
  - https://github.com/ivtipm/ProcessCalculus/blob/master/examples/example_thread/main.cpp
  - example1
  ``` {"places":["P1,228,138,0","P2,397,138,0","P3,460,308,0","P4,622,226,0","P5,620,140,0","P6,773,310,0","P7,469,224,0","P8,615,309,0","P9,766,229,0","P10,908,133,0","P11,1112,126,0"],"trans":["T1,328,141","T2,467,137","T3,538,312","T4,688,310","T5,540,226","T6,698,225","T7,829,133","T8,1007,130"],"arcs":["P1,T1","T1,P2","T1,P3","P2,T2","T2,P5","P3,T3","T3,P8","T2,P7","T4,P6","P7,T5","T5,P4","P4,T6","P8,T4","T6,P9","P5,T7","P9,T7","T7,P10","P10,T8","P6,T8","T8,P11"]}
  ```

Пример можно открыть в http://petri.hp102.ru/pnet.html


### Критическая секция
**Критическая секция (critical section)** – участок исполняемого кода программы, в котором производится доступ к общему ресурсу (данным или устройству),который не должен быть одновременно использованболее чем одним потоком выполнения.


- При нахождении в критической секции двух (или более) потоков возникает состояние гонки (неопределённость параллелизма).
- Для избежания данной ситуации необходимо выполнение четырех условий
  - Два потока не должны одновременно находиться вкритических областях.
  - В программе не должно быть предположений о скорости или количестве процессоров.
  - Поток, находящийся вне критической области, не может блокировать другие потоки.
  - Невозможна ситуация, вкоторой поток вечно ждет попадания в критическую область

### Мьютекс
**Мьютекс** (mutex = mutual exclusion — взаимное исключение) — примитив синхронизации, обеспечивающий взаимное исключение исполнения критических участков кода


- синхронизация с помощью мьютекса, критическая секция
[examples/thread-sync1](examples/thread-sync1/main.cpp)

- условные переменные

<!--
## Другие темы

- пулы потоков?

- Шаблоны проектирования параллельных алгоритмов? -->
